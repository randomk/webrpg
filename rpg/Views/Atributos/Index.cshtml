@model IList<rpg.Models.Atributos>
@{
    Layout = "~/Views/Shared/_Grid.cshtml";
}
@Styles.Render("~/bundles/modalcss")

<table id="tabelaGrid" cellpadding="0" cellspacing="0">
    <thead>
        <tr class="titulo">
            <td></td>
            <td>Descrição</td>
            <td></td>
            <td></td>
        </tr>
    </thead>
    <tbody>
        @foreach (var Atributos in Model)
        {
            <tr class="linha">
                <td></td>
                <td>@Atributos.Descricao</td>
                <td>
                    <a href="#" onclick="clickmodal(@Atributos.Cod_Atributo, '@Atributos.Descricao', '@Atributos.Ativo')">Editar</a>
                </td>
                <td>
                    <a href="#" onclick="deletar(@Atributos.Cod_Atributo, '@Atributos.Descricao', this)">Deletar</a>
                </td>
            </tr>
        }
    </tbody>
</table>
<div class="modal" id="modal" style="width: 500px; height: 200px;">

    <div class="fechar">
        <a href="#" onclick="fecharmodal()">Fechar</a>
    </div>
    <div class="titulomodal">
        <p id="titulomodal" style=" margin-left: 20px;">Editar Atributos</p>
    </div>
    <form method="post">
        <div class="modalform" style="width: 400px; height: 100%; float:left; margin-top:10px;">
            <div class="fordescricao linha">
                <input type="hidden" name="Atributos.Cod_Atributo" value="0" id="cod_atributo" />
                <label for="descricao">Descrição:</label>
                <input id="descricao" name="Atributos.Descricao" required />
            </div>
            <div class="linha">
                <input type="checkbox" value="ativo" id="ativo" name="Atributos.Ativo"/><span>Ativo</span>
            </div>
            
        </div>
        <div style="width: 80px; height: 100%;" class="divbtn">
            <input class="btnsalvar" id="btnsalvar" type="submit" value="Salvar" onclick="salvar()" style="margin-top: 125px;" />
        </div>
    </form>
</div>

<script>
    function clickmodal(id, descricao, ativo) {
        
        $('#cod_atributo').val(id);
        $('#descricao').val(descricao);
        $('#ativo').prop('checked', ativo)
        $('.modal').bPopup({
            modalClose: false
        });

    }

    function fecharmodal() {
        var bPopup = $('.modal').bPopup();
        bPopup.close();
    }

    function botaonovo() {
        clickmodal(0, "");
    }

    function salvar() {
        var cod_atributo = $('#cod_atributo').val();
        var descricao = $('#descricao').val();
        var ativo = $('#ativo').prop('checked')

        var url = "@Url.Action("Adiciona", "Atributos")";
        $.post(url, { cod_atributo: cod_atributo, descricao: descricao, ativo: ativo}, erro);
    }

    function deletar(cod_atributo, descricao, botao) {
       if (confirm("O Atributo " + descricao +" seá excluido do sistema ")) {
           var par = $(botao).parent().parent()
           par.remove();
           $('table tbody tr:odd').removeClass("zebraUm zebraDois").addClass('zebraUm');
           $('table tbody tr:even').removeClass("zebraUm zebraDois").addClass('zebraDois');

           var url = "@Url.Action("delete", "Atributos")";
           $.post(url, { cod_atributo: cod_atributo }, erro);
       }
   }

    function erro(msgerro) {
        if (msgerro != "") {
            alert(msgerro);
        }        
    }

</script>   